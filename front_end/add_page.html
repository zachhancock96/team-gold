<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="css/style.css">
	<title>Add Game</title>
</head>

<body>
	<header>
		<h1>Add Game</h1>
	</header>
	<form id="form">
		Home Team: 
		<select id="select_home_team">
			<option value="">Select Team</option>
		</select><br><br>
		
		Visiting Team: 
		<select id="select_visiting_team">
			<option value="">Select Team</option>
		</select><br><br>
		
		Start: 
		<input id="start" type="date" ><br><br>
		
		End: 
		<input id="end" type="date" ><br><br>


		Location: 
		<input id="location" type="text" name="location" placeholder="Location"><br><br>
		
		<input id="btn_submit" type="submit" >
	</form>
</body>

<script type='text/JavaScript' src="js/jquery.js"></script>
<script type='text/JavaScript' src="js/api.js"></script>

<script type='text/JavaScript'>
	//testing api.addGame
	const form = (function() {
		const selectHomeTeamEl = $('#select_home_team');
		const selectVisitingTeamEl = $('#select_visiting_team');
		const startEl = $('#start');
		const endEl = $('#end');
		const locationEl = $('#location');
		const btnSubmitEl = $('#btn_submit');

		const formEl = $('#form');

		let submitListener = null;

		/*
			@param teams: Array<{
				id,
				teamName
			}>
		*/
		function setTeams(teams) {
			let options = teams
				.map(team => `<option value=${team.id}>${team.teamName}</option>`);

			options.shift('<option value="">Select team</option>')
			
			//array to string conversion
			options = options.join('');

			//clear select element
			selectHomeTeamEl.empty();
			selectVisitingTeamEl.empty();

			//fill select element
			selectHomeTeamEl.append(options);
			selectVisitingTeamEl.append(options);
		}

		function setSubmitListener(listener) {
			submitListener = listener;
		}

		formEl.on('submit', function(e) {
			e.preventDefault();
			//scrape data out of form elements
			const game = {};
			
			game.homeTeamId = selectHomeTeamEl.val() || null;
			game.awayTeamId = selectVisitingTeamEl.val() || null;
			game.location = locationEl.val() || null;
			game.start = startEl.val() || null;
			game.end = endEl.val() || null;

			if(game.homeTeamId){
				game.homeTeamId = parseInt(game.homeTeamId);
			}
			if(game.awayTeamId){
				game.awayTeamId = parseInt(game.awayTeamId);
			}
			// notify listener
			if (submitListener != null) {
				submitListener(game);
			}
		});

		return {
			setTeams,
			setSubmitListener,
		}
	})();


	form.setSubmitListener(game => {
		if (game == null
			|| !game.homeTeamId
			|| !game.awayTeamId
			|| !game.location
			|| !game.start
			|| !game.end) {
				alert('invalid form data');
			}
		else {
			//TODO: add game
			api.addGame(game)
				.then(result => {
					console.log(result);
				})
				.catch(error => {
					console.log(error);
				})
		}
	});


	api.getTeams()
		.then(teams => {
			form.setTeams(teams);
		});


</script>
</html>
