<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="css/style.css">
	<title>Add Game</title>
</head>

<body>
	<header>
		Add Game
	</header>
	
	<table id='banner'>
        <tr>
        <td><a href='./game_view.html'>+ View Games +</a></td>
        <td class='dropdown'>+ Add Games +<div class='dropdown-content'><a href='./add_page.html'>Add Manually</a><hr />Upload File</div></td>
        <td>+ Verify Games +</td>
        <td class='dropdown'>+ Profile +<div class='dropdown-content'><a href='./user_profile.html'>User Profile</a> <hr /> <a href='./school_profile.html'>School Profile</a></div></td>  
        </tr>
	</table>
	
	<table id='add_page_table'>
		<form id="form">
			<tr>
			<td>Home Team:</td>
			<td><select id="select_home_team"><option value="">Select Team</option></select></td>
			
			<!--
			<td>Home Team:</td> 
			<td>
			<select name="HTeam">
				<option value="Boys Varsity">Boys Varsity</option>
				<option value="Girls Varsity">Girls Varsity</option>
				<option value="Boys JV">Boys JV</option>
				<option value="Girls JV">Girls JV</option>
			</select>
			</td>
			-->
			</tr>
			
			<tr>
			<td>Visting Team:</td> 
			<td><select id="select_visiting_team">
			<option value="">Select Team</option></select></td>    
			
			<!--
			<td>Visiting Team:</td> 
			<td>
			<select name="VTeam">
				<option value="Boys Varsity">Boys Varsity</option>
				<option value="Girls Varsity">Girls Varsity</option>
				<option value="Boys JV">Boys JV</option>
				<option value="Girls JV">Girls JV</option>
			</select>
			</td>
			-->
			</tr>
			
			<tr>
			<td>Start:</td> 
			<td><input id="start" type="date" ></td>
			</tr>
			
			<tr>
			<td>End:</td> 
			<td><input id="end" type="date" ></td>
			</tr>
			
			<tr>
			<td>Location:</td> 
			<td><input id="location" type="text" name="location" placeholder="Location"></td>
			</tr>
			
			<tr>
			<td colspan="4"><input id="btn_submit" type="submit" value="Add Game" ></td>
			</tr>
		</form>
	</table>
</body>

<script type='text/JavaScript' src="js/jquery.js"></script>
<script type='text/JavaScript' src="js/api.js"></script>

<script type='text/JavaScript'>
	//testing api.addGame
	const form = (function() {
		const selectHomeTeamEl = $('#select_home_team');
		const selectVisitingTeamEl = $('#select_visiting_team');
		const startEl = $('#start');
		const endEl = $('#end');
		const locationEl = $('#location');
		const btnSubmitEl = $('#btn_submit');

		const formEl = $('#form');

		let submitListener = null;

		/*
			@param teams: Array<{
				id,
				teamName
			}>
		*/
		function setTeams(teams) {
			let options = teams
				.map(team => `<option value=${team.id}>${team.teamName}</option>`);

			options.shift('<option value="">Select team</option>')
			
			//array to string conversion
			options = options.join('');

			//clear select element
			selectHomeTeamEl.empty();
			selectVisitingTeamEl.empty();

			//fill select element
			selectHomeTeamEl.append(options);
			selectVisitingTeamEl.append(options);
		}

		function setSubmitListener(listener) {
			submitListener = listener;
		}

		formEl.on('submit', function(e) {
			e.preventDefault();
			//scrape data out of form elements
			const game = {};
			
			game.homeTeamId = selectHomeTeamEl.val() || null;
			game.awayTeamId = selectVisitingTeamEl.val() || null;
			game.location = locationEl.val() || null;
			game.start = startEl.val() || null;
			game.end = endEl.val() || null;

			if(game.homeTeamId){
				game.homeTeamId = parseInt(game.homeTeamId);
			}
			if(game.awayTeamId){
				game.awayTeamId = parseInt(game.awayTeamId);
			}
			// notify listener
			if (submitListener != null) {
				submitListener(game);
			}
		});

		return {
			setTeams,
			setSubmitListener,
		}
	})();


	form.setSubmitListener(game => {
		if (game == null
			|| !game.homeTeamId
			|| !game.awayTeamId
			|| !game.location
			|| !game.start
			|| !game.end) {
				alert('invalid form data');
			}
		else {
			//TODO: add game
			api.addGame(game)
				.then(result => {
                                        alert('success!');
					console.log(result);
				})
				.catch(error => {
                  		        alert('Oops!');
					console.log(error);
				})
		}
	});


	api.getTeams()
		.then(teams => {
			form.setTeams(teams);
		});


</script>
</html>
