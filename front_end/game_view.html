<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Game Viewer</title>
    <link rel='stylesheet' href='css/style.css' />
    <link href='https://use.fontawesome.com/releases/v5.0.6/css/all.css' rel='stylesheet'>
    <link href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css' rel='stylesheet' />
    <link href='fullcalendar/core/main.css' rel='stylesheet' />
    <link href='fullcalendar/daygrid/main.css' rel='stylesheet' />
    <link href='fullcalendar/timegrid/main.css' rel='stylesheet' />
    <link href='fullcalendar/list/main.css' rel='stylesheet' />

    <script src='fullcalendar/core/main.js'></script>
    <script src='fullcalendar/interaction/main.js'></script>
    <script src='fullcalendar/daygrid/main.js'></script>
    <script src='fullcalendar/timegrid/main.js'></script>
    <script src='fullcalendar/list/main.js'></script>
    <script src='js/jquery.js'></script>
    <script src='js/api.js'></script>
    <script>

        //html is loaded
      document.addEventListener('DOMContentLoaded', calendarGames);
      
      function calendarGames() {
  
          //fetch games
        api.getGames().then(function(games){
          const gamesF = games.filter(mySchoolFunction);
          console.log(gamesF);
          
          //render calendar
          var calendarEl = document.getElementById('calendar');
          var todayDate = new Date();
          var calendar = new FullCalendar.Calendar(calendarEl, {
            plugins: [ 'interaction', 'dayGrid', 'timeGrid', 'list' ],
            header: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
            },
            defaultDate: todayDate,
            editable: true,
            navLinks: true, // can click day/week names to navigate views
            eventLimit: true, // allow "more" link when too many events
            events: gamesF
            });

            calendar.render();
        })
  
        }

  
      </script>
</head>

<body>
    <header>
        Game View
    </header>
	
	<!--
		Drop down browser banner
		View Games - shows list of games
		Add Manually - shows add games individually
		User Profile - shows user's individual profile
		School Profile - shows user's school profile
	-->
	<table id='banner'>
        <tr>
        <td><a href='./game_view.html'>+ View Games +</a></td>
        <td class='dropdown'>+ Add Games +<div class='dropdown-content'>
          <a href='./add_single_game.html'>Add Manually</a><hr />
          <a href='./file_upload.html'>Upload File</a></div></td>
        <td><a href='./verify_games.html'>+ Verify Games +</a></td>
        <td class='dropdown'>+ Profile +<div class='dropdown-content'>
          <a href='./user_profile.html'>User Profile</a> <hr /> 
          <a href='./school_profile.html'>School Profile</a> <hr />
          <a href='./school_permissions.html'>School Permissions</a></div></td>  
        </tr>
  </table>


  <!--
    Filter games
  -->

  <input type="text" id="schoolName" placeholder="Search for school..." title="school">
  
  <!--
  <input type="text" id="teamName" onkeyup="myteamFunction()" placeholder="Search for team..." title="team">
  <input type="text" id="genderName" onkeyup="mygenderFunction()" placeholder="Search for boys/girls..." title="gender">
  -->
  <button id="myBtn">Apply Filter</button>
  <script>
    document.getElementById("myBtn").addEventListener("click", calendarGames);
    
    function mySchoolFunction(gameN) {
      var input, filter, txtValue, i, a;
      input = document.getElementById('schoolName');
      filter = input.value.toUpperCase();
      a = gameN.title;
      txtValue = a.textContent || a.innerText;
      if(a.toUpperCase().indexOf(filter) > -1){
        return true;
      }
    }
  </script>
    <!--
        Show the calendar of games that have been added
    -->

    
    
      <div id='calendar'></div>


    <!--

    
    <div id = 'records'></div>

    <script type='text/JavaScript' src="js/jquery.js"></script>
    <script type='text/JavaScript' src="js/api.js"></script>

    <script type='text/JavaScript'>
        $(function() {
            api.getGames()
                    .then(result => {
    
              
                        let string='<table width="100%"><tr> <th>Home Team</th><th>Away Team</th> <th>Start</th> <th>End</th> <th>Location</th> </tr>';
    
                        $.each( result, function( key, value ){
                            string += `
                                <tr>
                                    <td>${value['homeTeam']['teamName']}</td>
                                    <td>${value['awayTeam']['teamName']}</td>
                                    <td>${value['start']}</td>
                                    <td>${value['end']}</td>
                                    <td>${value['location']}</td>
                                </tr>
                            `;
                        });
    
                        string += '</table>';
    
                        $('#records').html(string);
                        
                    })
                    .catch(error => console.log(error));
        });
    </script>
    -->
    
</body>
</html>
